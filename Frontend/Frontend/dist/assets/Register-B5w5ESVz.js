import{r as f,u as z,i as A,l as o,m as u,d as w,h as l,e as d,b as y,y as D,G as N,x as h,p as $,E as v,I as F,J as L}from"./index-QOScO0--.js";import{_ as S}from"./_plugin-vue_export-helper-DlAUqK2U.js";const T={class:"avatar-upload"},j={class:"avatar-wrapper"},G=["src"],J={key:1,class:"avatar-placeholder"},W={__name:"Register",props:{visible:Boolean},emits:["update:visible","switch-login"],setup(I,{emit:x}){const g=x,_=f(),m=f(""),p=f(null),a=f({name:"",studentId:"",email:"",password:"",confirmPassword:""}),U={name:[{required:!0,message:"请输入姓名",trigger:"blur"}],studentId:[{required:!0,message:"请输入学号",trigger:"blur"},{pattern:/^\d{8,12}$/,message:"学号为8-12位数字",trigger:"blur"}],email:[{required:!0,message:"请输入邮箱",trigger:"blur"},{type:"email",message:"请输入正确的邮箱地址",trigger:"blur"}],password:[{required:!0,message:"请输入密码",trigger:"blur"},{min:6,message:"密码至少6位",trigger:"blur"}],confirmPassword:[{required:!0,validator:k,trigger:"blur"}]},b=z();function k(t,e,s){e===""?s(new Error("请再次输入密码")):e!==a.value.password?s(new Error("两次输入密码不一致")):s()}function V(t){const e=t.type.startsWith("image/"),s=t.size/1024/1024<2;return e?(s||v.error("头像大小不能超过 2MB！"),!1):(v.error("头像必须是图片格式！"),!1)}function C(t){if(V(t.raw))return;p.value=t.raw;const e=new FileReader;e.onload=s=>{m.value=s.target.result},e.readAsDataURL(t.raw)}async function P(){_.value.validate(async t=>{if(t)try{const e={password:a.value.password,name:a.value.name,studentId:a.value.studentId,email:a.value.email};p.value&&(e.avatar=p.value);const s=await F(e);b.setToken(s.data.token);const c=await L(s.data.token);b.setUserInfo(c.data),v.success("注册成功"),g("update:visible",!1),a.value.name="",a.value.studentId="",a.value.email="",a.value.password="",a.value.confirmPassword="",m.value="",p.value=null}catch(e){v.error(e.response?.data?.msg||"注册失败")}})}function R(){g("update:visible",!1)}function B(t){g("update:visible",t)}return(t,e)=>{const s=u("el-icon"),c=u("el-upload"),n=u("el-form-item"),i=u("el-input"),q=u("el-button"),E=u("el-form"),M=u("el-dialog");return w(),A(M,{"model-value":I.visible,"onUpdate:modelValue":B,width:"480px","show-close":!0,center:"",title:"用户注册",onClose:R},{default:o(()=>[l(E,{model:a.value,rules:U,ref_key:"formRef",ref:_,"label-width":"90px",size:"large"},{default:o(()=>[l(n,{label:"头像",prop:"avatar"},{default:o(()=>[d("div",T,[l(c,{"show-file-list":!1,"before-upload":V,"on-change":C,accept:"image/*","auto-upload":!1},{default:o(()=>[d("div",j,[m.value?(w(),y("img",{key:0,src:m.value,class:"avatar-preview",alt:"头像预览"},null,8,G)):(w(),y("div",J,[l(s,{size:"40"},{default:o(()=>[l(D(N))]),_:1}),e[6]||(e[6]=d("div",null,"选择头像",-1))]))])]),_:1}),e[7]||(e[7]=d("div",{class:"avatar-tip"},"支持jpg、png格式，大小不超过2MB",-1))])]),_:1}),l(n,{label:"姓名",prop:"name"},{default:o(()=>[l(i,{modelValue:a.value.name,"onUpdate:modelValue":e[0]||(e[0]=r=>a.value.name=r),maxlength:"20","show-word-limit":"",placeholder:"请输入姓名"},null,8,["modelValue"])]),_:1}),l(n,{label:"学号",prop:"studentId"},{default:o(()=>[l(i,{modelValue:a.value.studentId,"onUpdate:modelValue":e[1]||(e[1]=r=>a.value.studentId=r),maxlength:"12","show-word-limit":"",placeholder:"请输入学号（8-12位数字）"},null,8,["modelValue"])]),_:1}),l(n,{label:"邮箱",prop:"email"},{default:o(()=>[l(i,{modelValue:a.value.email,"onUpdate:modelValue":e[2]||(e[2]=r=>a.value.email=r),maxlength:"40",placeholder:"请输入邮箱"},null,8,["modelValue"])]),_:1}),l(n,{label:"密码",prop:"password"},{default:o(()=>[l(i,{modelValue:a.value.password,"onUpdate:modelValue":e[3]||(e[3]=r=>a.value.password=r),type:"password",placeholder:"请输入密码","show-password":""},null,8,["modelValue"])]),_:1}),l(n,{label:"确认密码",prop:"confirmPassword"},{default:o(()=>[l(i,{modelValue:a.value.confirmPassword,"onUpdate:modelValue":e[4]||(e[4]=r=>a.value.confirmPassword=r),type:"password",placeholder:"确认密码","show-password":""},null,8,["modelValue"])]),_:1}),l(n,null,{default:o(()=>[l(q,{type:"primary",onClick:P,style:{width:"100%"}},{default:o(()=>e[8]||(e[8]=[h("注册")])),_:1,__:[8]})]),_:1}),l(n,{style:{"text-align":"center",width:"100%"}},{default:o(()=>[d("span",null,[e[9]||(e[9]=h("已有账号？")),d("a",{onClick:e[5]||(e[5]=$(r=>t.$emit("switch-login"),["prevent"])),style:{color:"#409eff",cursor:"pointer"}},"去登录")])]),_:1})]),_:1},8,["model"])]),_:1},8,["model-value"])}}},O=S(W,[["__scopeId","data-v-d59b9f58"]]);export{O as default};
