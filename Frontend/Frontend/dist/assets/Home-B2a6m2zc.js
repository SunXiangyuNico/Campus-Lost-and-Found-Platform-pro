import{u as ae,c as Y,r as L,w as te,o as ve,a as fe,b as k,d as m,e,f as ge,g as $e,h as s,i as A,j as D,v as Ve,k as _e,l as a,m as g,n as G,p as he,q as Ie,s as Le,t as ye,x,y as z,z as b,E as j,F as ue,A as de,B as we,C as Ce,D as Q,G as Be,H as je}from"./index-QOScO0--.js";import{g as le,a as me,f as pe}from"./index-oGPApeZQ.js";import{_ as oe}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{s as Me,a as Te}from"./messages-WA174WDX.js";import{c as Ue,g as Se,s as De,a as Ee}from"./items-Cme2rVli.js";import qe from"./Register-B5w5ESVz.js";const Re={class:"navbar"},ze={class:"navbar-container"},He={class:"navbar-left"},Pe={class:"search-section"},Ae={class:"search-wrapper"},Ze={class:"navbar-right"},Ne={class:"nav-menu"},Fe={class:"nav-icon-wrapper"},Oe={class:"auth-section"},Ke={class:"user-info"},We={class:"username"},Xe={__name:"Navbar",emits:["search","publish","login","register"],setup(p,{emit:E}){const t=ae(),h=Le();ye();const i=Y(()=>!!t.token),v=L(""),o=L(0);let y=null,B=null;function q(){const c=v.value.trim();c&&V("search",c)}function U(){B&&clearTimeout(B);const c=v.value.trim();c?B=setTimeout(()=>{V("search",c)},300):V("search","")}function _(){v.value="",V("search","")}function f(){V("login")}function l(){V("register")}function w(){if(!i.value){j.warning("请先登录后再发布信息"),V("login");return}V("publish")}function R(){t.logout(),h.push("/")}async function M(){if(!i.value){f();return}try{await t.checkLoginStatus(),t.isLogin?h.push("/profile"):f()}catch(c){console.error("检查登录状态失败:",c),f()}}function S(){console.log("=== 点击我的消息按钮 ==="),console.log("Token:",t.token?"存在":"不存在"),console.log("用户信息:",t.userInfo),console.log("当前登录状态(isLogin):",i.value),console.log("Store状态:",{hasToken:!!t.token,hasUserInfo:!!t.userInfo,hasUserId:!!(t.userInfo&&t.userInfo.id)}),console.log("让router-link执行默认导航...")}async function H(){if(!i.value||!t.token){o.value=0;return}try{const c=await Ie.get("/api/messages/unread-count");o.value=c.data.total||0}catch(c){console.error("获取未读消息数量失败:",c)}}function r(){y&&clearInterval(y),H(),y=setInterval(()=>{H()},3e4)}function u(){y&&(clearInterval(y),y=null),o.value=0}const V=E;return te(i,c=>{c?r():u()}),ve(async()=>{if(t.token&&!t.userInfo)try{await t.refreshUserInfo()}catch(c){console.error("初始化用户信息失败:",c)}i.value&&r(),window.addEventListener("avatar-updated",()=>{t.refreshUserInfo()}),window.addEventListener("message-updated",()=>{H()})}),fe(()=>{u(),window.removeEventListener("avatar-updated",()=>{t.refreshUserInfo()}),window.removeEventListener("message-updated",()=>{H()})}),(c,d)=>{const Z=g("el-button"),T=g("router-link"),O=g("el-badge"),J=g("el-avatar"),ce=g("el-dropdown-item"),ee=g("el-dropdown-menu"),K=g("el-dropdown");return m(),k("header",Re,[e("div",ze,[e("div",He,[d[4]||(d[4]=ge('<div class="logo-section" data-v-90ce82c8><div class="logo-icon" data-v-90ce82c8><svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-90ce82c8><path d="M21 21L16.514 16.506L21 21ZM19 10.5C19 15.194 15.194 19 10.5 19C5.806 19 2 15.194 2 10.5C2 5.806 5.806 2 10.5 2C15.194 2 19 5.806 19 10.5Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" data-v-90ce82c8></path></svg></div><span class="brand" data-v-90ce82c8>校园失物招领平台</span></div>',1)),e("div",Pe,[e("div",Ae,[d[3]||(d[3]=e("div",{class:"search-icon"},[e("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg"},[e("path",{d:"M21 21L16.514 16.506L21 21ZM19 10.5C19 15.194 15.194 19 10.5 19C5.806 19 2 15.194 2 10.5C2 5.806 5.806 2 10.5 2C15.194 2 19 5.806 19 10.5Z",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"})])],-1)),$e(e("input",{type:"text",placeholder:"搜索物品名称、描述、地点...",class:"search-input","onUpdate:modelValue":d[0]||(d[0]=N=>v.value=N),onKeyup:_e(q,["enter"]),onInput:U},null,544),[[Ve,v.value]]),s(Z,{type:"primary",class:"search-btn",onClick:q,disabled:!v.value.trim()},{default:a(()=>d[1]||(d[1]=[x(" 搜索 ")])),_:1,__:[1]},8,["disabled"]),v.value.trim()?(m(),A(Z,{key:0,type:"text",class:"clear-btn",onClick:_,title:"清除搜索"},{default:a(()=>d[2]||(d[2]=[e("svg",{width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg"},[e("line",{x1:"18",y1:"6",x2:"6",y2:"18",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"}),e("line",{x1:"6",y1:"6",x2:"18",y2:"18",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"})],-1)])),_:1,__:[2]})):D("",!0)])])]),e("div",Ze,[e("nav",Ne,[s(T,{to:"/",class:G(["nav-item",{active:c.$route.path==="/"}])},{default:a(()=>d[5]||(d[5]=[e("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg"},[e("path",{d:"M3 9L12 2L21 9V20C21 20.5304 20.7893 21.0391 20.4142 21.4142C20.0391 21.7893 19.5304 22 19 22H5C4.46957 22 3.96086 21.7893 3.58579 21.4142C3.21071 21.0391 3 20.5304 3 20V9Z",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"}),e("polyline",{points:"9,22 9,12 15,12 15,22",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"})],-1),x(" 首页 ")])),_:1,__:[5]},8,["class"]),i.value?(m(),A(T,{key:0,to:"/messages",class:G(["nav-item message-nav",{active:c.$route.path.startsWith("/messages")}]),onClick:S},{default:a(()=>[e("div",Fe,[d[6]||(d[6]=e("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg"},[e("path",{d:"M21 15C21 15.5304 20.7893 16.0391 20.4142 16.4142C20.0391 16.7893 19.5304 17 19 17H7L3 21V5C3 4.46957 3.21071 3.96086 3.58579 3.58579C3.96086 3.21071 4.46957 3 5 3H19C19.5304 3 20.0391 3.21071 20.4142 3.58579C20.7893 3.96086 21 4.46957 21 5V15Z",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"})],-1)),o.value>0?(m(),A(O,{key:0,value:o.value>99?"99+":o.value,max:99,class:"message-badge"},null,8,["value"])):D("",!0)]),d[7]||(d[7]=x(" 我的消息 "))]),_:1,__:[7]},8,["class"])):D("",!0),s(T,{to:"/profile",class:G(["nav-item",{active:c.$route.path.startsWith("/profile")}]),onClick:he(M,["prevent"])},{default:a(()=>d[8]||(d[8]=[e("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg"},[e("path",{d:"M20 21V19C20 17.9391 19.5786 16.9217 18.8284 16.1716C18.0783 15.4214 17.0609 15 16 15H8C6.93913 15 5.92172 15.4214 5.17157 16.1716C4.42143 16.9217 4 17.9391 4 19V21",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"}),e("circle",{cx:"12",cy:"7",r:"4",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"})],-1),x(" 个人中心 ")])),_:1,__:[8]},8,["class"])]),e("div",Oe,[i.value?D("",!0):(m(),A(Z,{key:0,type:"text",class:"login-btn",onClick:f},{default:a(()=>d[9]||(d[9]=[x(" 登录 ")])),_:1,__:[9]})),i.value?D("",!0):(m(),A(Z,{key:1,type:"text",class:"register-btn",onClick:l},{default:a(()=>d[10]||(d[10]=[x(" 注册 ")])),_:1,__:[10]})),s(Z,{type:"primary",class:"publish-btn",onClick:w},{default:a(()=>d[11]||(d[11]=[e("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg"},[e("line",{x1:"12",y1:"5",x2:"12",y2:"19",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"}),e("line",{x1:"5",y1:"12",x2:"19",y2:"12",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"})],-1),x(" 发布 ")])),_:1,__:[11]}),i.value?(m(),A(K,{key:2,class:"user-dropdown"},{dropdown:a(()=>[s(ee,null,{default:a(()=>[s(ce,{onClick:R},{default:a(()=>d[13]||(d[13]=[e("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg"},[e("path",{d:"M9 21H5C4.46957 21 3.96086 20.7893 3.58579 20.4142C3.21071 20.0391 3 19.5304 3 19V5C3 4.46957 3.21071 3.96086 3.58579 3.58579C3.96086 3.21071 4.46957 3 5 3H9",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"}),e("polyline",{points:"16,17 21,12 16,7",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"}),e("line",{x1:"21",y1:"12",x2:"9",y2:"12",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"})],-1),x(" 退出登录 ")])),_:1,__:[13]})]),_:1})]),default:a(()=>[e("div",Ke,[s(J,{size:32,src:z(t).userInfo?.avatar?z(le)(z(t).userInfo.avatar):void 0},{default:a(()=>[x(b(z(t).userInfo?.name?.[0]||"U"),1)]),_:1},8,["src"]),e("span",We,b(z(t).userInfo?.name||"用户"),1),d[12]||(d[12]=e("svg",{width:"12",height:"12",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg"},[e("polyline",{points:"6,9 12,15 18,9",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"})],-1))])]),_:1})):D("",!0)])])])])}}},Qe=oe(Xe,[["__scopeId","data-v-90ce82c8"]]),Ye={class:"post-list-container"},Ge={key:0,class:"post-list-scroll"},Je=["onClick"],et={key:0,class:"claimed-badge"},tt={class:"post-info"},ot={class:"info-row top"},st={class:"post-name"},nt={class:"user-name"},lt={class:"info-row bottom"},at={class:"location"},rt={class:"post-date"},it={key:1,class:"empty-state"},ut={__name:"PostList",props:{posts:{type:Array,required:!0},selectedId:{type:String,default:null}},emits:["select"],setup(p){function E(i){if(!i)return"未知日期";try{const v=new Date(i);return`${v.getMonth()+1}月${v.getDate()}日`}catch{return"无效日期"}}function t(i){return i.claimed||i.is_claimed?"claimed":i.status==="lost"?"lost":"found"}function h(i){return i.claimed||i.is_claimed,i.status==="lost"?"失":"拾"}return(i,v)=>(m(),k("div",Ye,[p.posts&&p.posts.length>0?(m(),k("div",Ge,[(m(!0),k(ue,null,de(p.posts,o=>(m(),k("div",{key:o.id,class:G(["post-item",{selected:o.id===p.selectedId}]),onClick:y=>i.$emit("select",o.id)},[e("div",{class:G(["status-icon",t(o)])},[x(b(h(o))+" ",1),o.claimed||o.is_claimed?(m(),k("div",et,"✓")):D("",!0)],2),e("div",tt,[e("div",ot,[e("span",st,b(o.name),1),e("span",nt,b(o.user.name),1)]),e("div",lt,[e("span",at,[v[0]||(v[0]=e("svg",{width:"12",height:"12",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg"},[e("path",{d:"M21 10c0 7-9 13-9 13s-9-7-9-10a9 9 0 1 1 18 0z",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"}),e("path",{d:"M12 10a3 3 0 1 0 0-6 3 3 0 0 0 0 6z",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"})],-1)),x(" "+b(o.location||"未指定地点"),1)]),e("span",rt,b(E(o.date)),1)])])],10,Je))),128))])):(m(),k("div",it,v[1]||(v[1]=[e("div",{class:"empty-icon"},[e("svg",{width:"48",height:"48",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg"},[e("path",{d:"M11 19.5a8.5 8.5 0 1 0 0-17 8.5 8.5 0 0 0 0 17zM21.5 21.5l-4-4",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"})])],-1),e("p",null,"暂无相关帖子",-1)])))]))}},dt=oe(ut,[["__scopeId","data-v-2205361a"]]),ct={class:"send-message-form"},mt={class:"user-info"},pt={class:"user-details"},vt={class:"user-name"},ft={key:0,class:"related-item"},gt={class:"message-tips"},ht={class:"dialog-footer"},wt={__name:"SendMessageDialog",props:{visible:{type:Boolean,default:!1},user:{type:Object,default:null},relatedItem:{type:Object,default:null}},emits:["update:visible","sent"],setup(p,{emit:E}){const t=ae(),h=p,i=E,v=L(!1),o=L(!1),y=L(),B=we({content:""}),q={content:[{required:!0,message:"请输入消息内容",trigger:"blur"},{min:1,max:1e3,message:"消息长度应在 1 到 1000 个字符之间",trigger:"blur"}]};te(()=>h.visible,f=>{v.value=f,f&&(h.relatedItem?B.content=`您好，我对您发布的"${h.relatedItem.name}"感兴趣，`:B.content="")}),te(v,f=>{i("update:visible",f)});const U=()=>{v.value=!1,B.content="",y.value&&y.value.resetFields()},_=async()=>{if(!y.value||o.value)return;try{await y.value.validate()}catch{return}if(!h.user?.id){j.error("用户信息无效");return}if(!t.token){j.error("请先登录");return}o.value=!0;const f=j({message:"正在发送消息...",type:"info",duration:0,showClose:!1});try{await Me(h.user.id,B.content.trim(),h.relatedItem?.id),f.close(),j.success("消息发送成功"),window.dispatchEvent(new CustomEvent("message-updated")),i("sent",{user:h.user,content:B.content.trim(),relatedItem:h.relatedItem}),U()}catch(l){f.close(),console.error("发送消息失败:",l);let w="发送消息失败";l.response?.status===401?w="登录已过期，请重新登录":l.response?.status===403?w="没有权限发送消息":l.response?.status===404?w="接收用户不存在":l.response?.status===400?w=l.response?.data?.message||"请求参数有误":l.response?.status>=500?w="服务器繁忙，请稍后再试":l.code==="NETWORK_ERROR"||!navigator.onLine?w="网络连接失败，请检查网络后重试":l.message&&(w=l.message),j.error(w)}finally{o.value=!1}};return(f,l)=>{const w=g("el-avatar"),R=g("el-input"),M=g("el-form-item"),S=g("el-form"),H=g("el-alert"),r=g("el-button"),u=g("el-dialog");return m(),A(u,{modelValue:v.value,"onUpdate:modelValue":l[1]||(l[1]=V=>v.value=V),title:`发送私信给 ${p.user?.name||"用户"}`,width:"500px","destroy-on-close":"",onClose:U},{footer:a(()=>[e("div",ht,[s(r,{onClick:U},{default:a(()=>l[3]||(l[3]=[x("取消")])),_:1,__:[3]}),s(r,{type:"primary",onClick:_,loading:o.value,disabled:!B.content.trim()},{default:a(()=>[x(b(o.value?"发送中...":"发送消息"),1)]),_:1},8,["loading","disabled"])])]),default:a(()=>[e("div",ct,[e("div",mt,[s(w,{size:40,src:z(le)(p.user?.avatar)},{default:a(()=>[x(b(p.user?.name?.[0]||"U"),1)]),_:1},8,["src"]),e("div",pt,[e("div",vt,b(p.user?.name||"未知用户"),1),p.relatedItem?(m(),k("div",ft," 关于物品："+b(p.relatedItem.name),1)):D("",!0)])]),s(S,{ref_key:"formRef",ref:y,model:B,rules:q,"label-width":"60px"},{default:a(()=>[s(M,{label:"消息",prop:"content"},{default:a(()=>[s(R,{modelValue:B.content,"onUpdate:modelValue":l[0]||(l[0]=V=>B.content=V),type:"textarea",rows:6,placeholder:"输入您要发送的消息...",maxlength:"1000","show-word-limit":"",onKeyup:_e(he(_,["ctrl"]),["enter"])},null,8,["modelValue","onKeyup"])]),_:1})]),_:1},8,["model"]),e("div",gt,[s(H,{title:"提示",type:"info",closable:!1,"show-icon":""},{default:a(()=>l[2]||(l[2]=[e("div",{class:"tips-content"},[e("p",null,"• 请文明用语，友善交流"),e("p",null,"• 建议在消息中说明您的需求或情况"),e("p",null,"• 可以按 Ctrl + Enter 快速发送")],-1)])),_:1})])])]),_:1},8,["modelValue","title"])}}},kt=oe(wt,[["__scopeId","data-v-a0633160"]]),_t={class:"post-detail"},yt={class:"post-header"},Ct={class:"user-info"},bt={class:"user-details"},xt={class:"post-meta"},$t={class:"post-time"},Vt={class:"post-actions"},It={class:"action-buttons"},Lt={key:0,class:"claimed-info"},Bt={class:"claimed-details"},jt={key:0,class:"claimed-time"},Mt={key:1,class:"claimed-by"},Tt={class:"post-content"},Ut={class:"post-title"},St={class:"content-section"},Dt={class:"post-description"},Et={key:0,class:"content-section"},qt={class:"image-gallery"},Rt=["onClick"],zt=["src","alt"],Ht={class:"content-section"},Pt={class:"location-info"},At={class:"location-text"},Zt={class:"map-container"},Nt=["src"],Ft={class:"content-section"},Ot={key:0,class:"comments-list"},Kt={class:"comment-content"},Wt={class:"comment-header"},Xt=["onClick"],Qt={class:"comment-time"},Yt={class:"comment-text"},Gt={key:1,class:"empty-comments"},Jt={class:"comment-input"},eo={__name:"PostDetail",props:{post:{type:Object,required:!0},mapImg:{type:String,required:!1},isLogin:{type:Boolean,default:!1}},emits:["claim","comment","require-login"],setup(p,{emit:E}){const t=p,h=E,i=L(""),v=ae(),o=we({show:!1,user:null,relatedItem:null}),y=Y(()=>t.post.claimed||t.post.is_claimed);function B(){if(y.value){j.info("该物品已被认领");return}if(!t.isLogin){Q.confirm("您还未登录，请先登录后再联系！","未登录",{confirmButtonText:"去登录",cancelButtonText:"取消",type:"warning",showClose:!0,distinguishCancelAndClose:!0}).then(()=>{h("require-login")}).catch(()=>{});return}const r=t.post.contact||t.post.user?.email||"暂无联系方式";Q.alert(`请通过以下方式联系帖主：
${r}`,"联系方式",{confirmButtonText:"我知道了",type:"info",center:!0})}async function q(){if(!t.isLogin){h("require-login");return}if(t.post.user?.id===v.userInfo?.id||t.post.userId===v.userInfo?.id){j.error("不能认领自己发布的物品");return}try{const{value:r}=await Q.prompt("请说明您认领这个物品的原因或提供相关证明：","发送认领申请",{confirmButtonText:"发送申请",cancelButtonText:"取消",inputType:"textarea",inputPlaceholder:"例如：这是我丢失的物品，物品特征是...",inputValidator:u=>!u||u.trim().length<10?"请至少输入10个字符说明认领原因":u.length>500?"说明内容不能超过500字符":!0});await Te(t.post.id,r.trim(),v.token),j.success("认领申请已发送，请等待物品发布者确认"),window.dispatchEvent(new CustomEvent("message-updated"))}catch(r){r!=="cancel"&&(console.error("发送认领申请失败:",r),j.error(r.message||"发送认领申请失败"))}}function U(){if(i.value.trim()){if(!t.isLogin){Q.confirm("您还未登录，请先登录后再评论！","未登录",{confirmButtonText:"去登录",cancelButtonText:"取消",type:"warning",showClose:!0,distinguishCancelAndClose:!0}).then(()=>{h("require-login")}).catch(()=>{});return}h("comment",i.value),j.success("评论已发送"),i.value=""}}function _(r){window.open(r,"_blank")}function f(){const r=t.post.claimedBy||t.post.claimed_by;return typeof r=="object"&&r!==null&&(r.name||r.username)||"认领者"}function l(){const r=t.post.claimedBy||t.post.claimed_by;return typeof r=="object"&&r!==null?le(r.avatar):null}function w(){if(!t.isLogin){Q.confirm("您还未登录，请先登录后再发送私信！","未登录",{confirmButtonText:"去登录",cancelButtonText:"取消",type:"warning",showClose:!0,distinguishCancelAndClose:!0}).then(()=>{h("require-login")}).catch(()=>{});return}const r=t.post.claimedBy||t.post.claimed_by;if(!r||typeof r!="object"){j.warning("无法获取认领者信息");return}if(r.id===v.userInfo?.id){j.info("这是您认领的物品");return}const u={id:r.id,name:r.name||r.username||"认领者",avatar:r.avatar},V={id:t.post.id,name:t.post.title||t.post.name,description:t.post.desc||t.post.description};o.user=u,o.relatedItem=V,o.show=!0}te(()=>t.post.id,()=>{i.value=""});const R=Y(()=>{if(!t.post.locationCoord)return{};const[r,u]=t.post.locationCoord;return{left:r+"px",top:u+"px"}});function M(){if(!t.isLogin){Q.confirm("您还未登录，请先登录后再发送私信！","未登录",{confirmButtonText:"去登录",cancelButtonText:"取消",type:"warning",showClose:!0,distinguishCancelAndClose:!0}).then(()=>{h("require-login")}).catch(()=>{});return}if(t.post.user?.id===v.userInfo?.id||t.post.userId===v.userInfo?.id){j.info("不能给自己发送私信");return}const r={id:t.post.user?.id||t.post.userId,name:me(t.post),avatar:t.post.user?.avatar||t.post.avatar},u={id:t.post.id,name:t.post.title||t.post.name,description:t.post.desc||t.post.description};o.user=r,o.relatedItem=u,o.show=!0}function S(r){if(!t.isLogin){Q.confirm("您还未登录，请先登录后再发送私信！","未登录",{confirmButtonText:"去登录",cancelButtonText:"取消",type:"warning",showClose:!0,distinguishCancelAndClose:!0}).then(()=>{h("require-login")}).catch(()=>{});return}if(r.author_id===v.userInfo?.id){j.info("不能给自己发送私信");return}const u={id:r.author_id,name:r.nickname,avatar:r.avatar},V={id:t.post.id,name:t.post.title||t.post.name,description:t.post.desc||t.post.description};o.user=u,o.relatedItem=V,o.show=!0}function H(r){j.success(`已向 ${r.user.name} 发送私信`)}return(r,u)=>{const V=g("el-avatar"),c=g("el-button"),d=g("el-tag"),Z=g("el-input");return m(),k("div",_t,[e("div",yt,[e("div",Ct,[s(V,{src:z(le)(p.post.user?.avatar||p.post.avatar),size:"large",class:"user-avatar",onClick:M},{default:a(()=>[x(b(z(me)(p.post)[0]||"U"),1)]),_:1},8,["src"]),e("div",bt,[e("div",{class:"user-name clickable",onClick:M},b(z(me)(p.post)),1),e("div",xt,[e("span",$t,b(z(pe)(p.post.time)),1),e("span",{class:G(["post-type-badge",p.post.type])},b(p.post.type==="lost"?"失物":"招领"),3)])])]),e("div",Vt,[e("div",It,[s(c,{type:"primary",size:"large",disabled:y.value,onClick:B,class:"contact-btn"},{default:a(()=>[u[2]||(u[2]=e("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg"},[e("path",{d:"M22 2H2C1.46957 2 0.960859 2.21071 0.585786 2.58579C0.210714 2.96086 0 3.46957 0 4V22C0 22.5304 0.210714 23.0391 0.585786 23.4142C0.960859 23.7893 1.46957 24 2 24H22C22.5304 24 23.0391 23.7893 23.4142 23.4142C23.7893 23.0391 24 22.5304 24 22V4C24 3.46957 23.7893 2.96086 23.4142 2.58579C23.0391 2.21071 22.5304 2 22 2Z",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"}),e("polyline",{points:"22,6 12,13 2,6",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"})],-1)),x(" "+b(y.value?"已认领":"联系帖主"),1)]),_:1,__:[2]},8,["disabled"]),p.post.status==="found"&&!y.value?(m(),A(c,{key:0,type:"success",size:"large",onClick:q,class:"claim-btn"},{default:a(()=>u[3]||(u[3]=[x(" 申请认领 ")])),_:1,__:[3]})):D("",!0)]),y.value?(m(),k("div",Lt,[s(d,{type:"success",size:"large"},{default:a(()=>u[4]||(u[4]=[e("svg",{width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg"},[e("path",{d:"M20 6L9 17L4 12",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"})],-1),x(" 此物品已被认领 ")])),_:1,__:[4]}),e("div",Bt,[p.post.claimedAt||p.post.claimed_at?(m(),k("span",jt," 认领时间："+b(z(pe)(p.post.claimedAt||p.post.claimed_at)),1)):D("",!0),p.post.claimedBy||p.post.claimed_by?(m(),k("div",Mt,[u[5]||(u[5]=e("span",null,"认领者：",-1)),s(V,{src:l(),size:"small",class:"claimed-user-avatar",onClick:w},{default:a(()=>[x(b(f()[0]||"U"),1)]),_:1},8,["src"]),e("span",{class:"claimed-user-name clickable",onClick:w},b(f()),1),u[6]||(u[6]=e("span",{class:"claimed-contact-tip"},"（可私信联系）",-1))])):D("",!0)])])):D("",!0)])]),e("div",Tt,[e("h1",Ut,b(p.post.title),1),e("div",St,[u[7]||(u[7]=ge('<h3 class="section-title" data-v-c150542e><svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-c150542e><path d="M14 2H6C5.46957 2 4.96086 2.21071 4.58579 2.58579C4.21071 2.96086 4 3.46957 4 4V20C4 20.5304 4.21071 21.0391 4.58579 21.4142C4.96086 21.7893 5.46957 22 6 22H18C18.5304 22 19.0391 21.7893 19.4142 21.4142C19.7893 21.0391 20 20.5304 20 20V8L14 2Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" data-v-c150542e></path><polyline points="14,2 14,8 20,8" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" data-v-c150542e></polyline><line x1="16" y1="13" x2="8" y2="13" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" data-v-c150542e></line><line x1="16" y1="17" x2="8" y2="17" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" data-v-c150542e></line><polyline points="10,9 9,9 8,9" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" data-v-c150542e></polyline></svg> 物品描述 </h3>',1)),e("p",Dt,b(p.post.desc),1)]),p.post.images&&p.post.images.length?(m(),k("div",Et,[u[8]||(u[8]=ge('<h3 class="section-title" data-v-c150542e><svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-c150542e><rect x="3" y="3" width="18" height="18" rx="2" ry="2" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" data-v-c150542e></rect><circle cx="8.5" cy="8.5" r="1.5" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" data-v-c150542e></circle><polyline points="21,15 16,10 5,21" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" data-v-c150542e></polyline></svg> 相关图片 </h3>',1)),e("div",qt,[(m(!0),k(ue,null,de(p.post.images,(T,O)=>(m(),k("div",{key:O,class:"image-item",onClick:J=>_(T)},[e("img",{src:T,alt:`图片 ${O+1}`},null,8,zt)],8,Rt))),128))])])):D("",!0),e("div",Ht,[u[9]||(u[9]=e("h3",{class:"section-title"},[e("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg"},[e("path",{d:"M21 10C21 17 12 23 12 23S3 17 3 10C3 7.61305 3.94821 5.32387 5.63604 3.63604C7.32387 1.94821 9.61305 1 12 1C14.3869 1 16.6761 1.94821 18.364 3.63604C20.0518 5.32387 21 7.61305 21 10Z",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"}),e("circle",{cx:"12",cy:"10",r:"3",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"})]),x(" 丢失/拾取地点 ")],-1)),e("div",Pt,[e("div",At,b(p.post.locationText),1),e("div",Zt,[e("img",{src:p.mapImg,class:"map-img",alt:"校园地图"},null,8,Nt),p.post.locationCoord?(m(),k("div",{key:0,class:"map-marker",style:Ce(R.value)},null,4)):D("",!0)])])]),e("div",Ft,[u[12]||(u[12]=e("h3",{class:"section-title"},[e("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg"},[e("path",{d:"M21 15C21 15.5304 20.7893 16.0391 20.4142 16.4142C20.0391 16.7893 19.5304 17 19 17H7L3 21V5C3 4.46957 3.21071 3.96086 3.58579 3.58579C3.96086 3.21071 4.46957 3 5 3H19C19.5304 3 20.0391 3.21071 20.4142 3.58579C20.7893 3.96086 21 4.46957 21 5V15Z",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"})]),x(" 评论区 ")],-1)),p.post.comments&&p.post.comments.length?(m(),k("div",Ot,[(m(!0),k(ue,null,de(p.post.comments,(T,O)=>(m(),k("div",{key:O,class:"comment-item"},[s(V,{src:z(le)(T.avatar),size:"small",class:"comment-avatar",onClick:J=>S(T)},{default:a(()=>[x(b(T.nickname?.[0]||"U"),1)]),_:2},1032,["src","onClick"]),e("div",Kt,[e("div",Wt,[e("span",{class:"comment-author clickable",onClick:J=>S(T)},b(T.nickname),9,Xt),e("span",Qt,b(z(pe)(T.time)),1)]),e("p",Yt,b(T.content),1)])]))),128))])):(m(),k("div",Gt,u[10]||(u[10]=[e("svg",{width:"32",height:"32",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg"},[e("path",{d:"M21 15C21 15.5304 20.7893 16.0391 20.4142 16.4142C20.0391 16.7893 19.5304 17 19 17H7L3 21V5C3 4.46957 3.21071 3.96086 3.58579 3.58579C3.96086 3.21071 4.46957 3 5 3H19C19.5304 3 20.0391 3.21071 20.4142 3.58579C20.7893 3.96086 21 4.46957 21 5V15Z",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"})],-1),e("p",null,"暂无评论",-1)]))),e("div",Jt,[s(Z,{modelValue:i.value,"onUpdate:modelValue":u[0]||(u[0]=T=>i.value=T),placeholder:"写下你的评论...",type:"textarea",rows:3,maxlength:"200","show-word-limit":""},null,8,["modelValue"]),s(c,{type:"primary",onClick:U,disabled:!i.value.trim(),class:"send-btn"},{default:a(()=>u[11]||(u[11]=[x(" 发送评论 ")])),_:1,__:[11]},8,["disabled"])])])]),s(kt,{visible:o.show,"onUpdate:visible":u[1]||(u[1]=T=>o.show=T),user:o.user,"related-item":o.relatedItem,onSent:H},null,8,["visible","user","related-item"])])}}},to=oe(eo,[["__scopeId","data-v-c150542e"]]),oo="/assets/map-DXbtSn6u.png",so={class:"map-select-block"},no={key:0,class:"map-coord-tip"},lo={__name:"NewPostForm",emits:["success"],setup(p,{emit:E}){const t=E,h=L(),i=L(),v=L(!1),o=we({status:"lost",name:"",category:"",date:null,mapCoord:null,location:"",images:[],description:"",contact:""}),y={status:[{required:!0,message:"请选择帖子类型",trigger:"change"}],name:[{required:!0,message:"请输入物品名称",trigger:"blur"}],category:[{required:!0,message:"请选择物品类别",trigger:"change"}],date:[{required:!0,message:"请选择时间",trigger:"change"}],mapCoord:[{required:!0,message:"请在地图上选择位置",trigger:"change"}],location:[{required:!0,message:"请输入详细地点描述",trigger:"blur"}],description:[{required:!0,message:"请输入详细描述",trigger:"blur"}],contact:[{required:!0,message:"请输入联系方式",trigger:"blur"}]},B=Y(()=>o.mapCoord?{left:o.mapCoord[0]+"px",top:o.mapCoord[1]+"px"}:{});function q(f){const l=i.value.getBoundingClientRect(),w=Math.round(f.clientX-l.left),R=Math.round(f.clientY-l.top);o.mapCoord=[w,R]}function U(f,l){o.images=l}async function _(){if(h.value){try{await h.value.validate()}catch{j.error("表单填写不完整，请检查所有必填项");return}v.value=!0;try{const f=new FormData;f.append("name",o.name),f.append("description",o.description),f.append("category",o.category),f.append("status",o.status),f.append("date",o.date.toISOString()),f.append("contact",o.contact),f.append("mapCoord",JSON.stringify(o.mapCoord)),f.append("location",o.location),o.images.forEach(w=>{w.raw&&f.append("images",w.raw)});const l=await Ue(f);l.status===201?(j.success("发布成功！"),t("success"),h.value.resetFields(),o.images=[]):j.warning(`操作完成，但服务器状态为: ${l.status}`)}catch(f){const l=f.response?.data?.msg||"发布失败，请检查网络或联系管理员";j.error(l)}finally{v.value=!1}}}return(f,l)=>{const w=g("el-option"),R=g("el-select"),M=g("el-form-item"),S=g("el-input"),H=g("el-date-picker"),r=g("el-icon"),u=g("el-upload"),V=g("el-button"),c=g("el-form");return m(),A(c,{model:o,rules:y,ref_key:"formRef",ref:h,"label-width":"100px",size:"large"},{default:a(()=>[s(M,{label:"帖子类型",prop:"status"},{default:a(()=>[s(R,{modelValue:o.status,"onUpdate:modelValue":l[0]||(l[0]=d=>o.status=d),placeholder:"请选择"},{default:a(()=>[s(w,{label:"我丢失了物品 (发布失物帖)",value:"lost"}),s(w,{label:"我捡到了物品 (发布招领帖)",value:"found"})]),_:1},8,["modelValue"])]),_:1}),s(M,{label:"物品名称",prop:"name"},{default:a(()=>[s(S,{modelValue:o.name,"onUpdate:modelValue":l[1]||(l[1]=d=>o.name=d),placeholder:"请输入物品名称"},null,8,["modelValue"])]),_:1}),s(M,{label:"物品类别",prop:"category"},{default:a(()=>[s(R,{modelValue:o.category,"onUpdate:modelValue":l[2]||(l[2]=d=>o.category=d),placeholder:"请选择"},{default:a(()=>[s(w,{label:"证件",value:"id"}),s(w,{label:"电子产品",value:"electronics"}),s(w,{label:"书籍",value:"book"}),s(w,{label:"衣物",value:"clothes"}),s(w,{label:"钥匙",value:"key"}),s(w,{label:"其他",value:"other"})]),_:1},8,["modelValue"])]),_:1}),s(M,{label:o.status==="found"?"捡到时间":"丢失时间",prop:"date"},{default:a(()=>[s(H,{modelValue:o.date,"onUpdate:modelValue":l[3]||(l[3]=d=>o.date=d),type:"datetime",placeholder:"请选择准确的日期和时间",style:{width:"100%"}},null,8,["modelValue"])]),_:1},8,["label"]),s(M,{label:o.status==="found"?"捡到地点":"丢失地点",prop:"mapCoord"},{default:a(()=>[e("div",so,[l[8]||(l[8]=e("div",{class:"map-select-tip"},"请在地图上点击选择具体位置",-1)),e("div",{class:"map-select-img-wrapper",onClick:l[4]||(l[4]=d=>q(d))},[e("img",{src:oo,class:"map-img",ref_key:"mapRef",ref:i},null,512),o.mapCoord?(m(),k("div",{key:0,class:"map-marker",style:Ce(B.value)},null,4)):D("",!0)]),o.mapCoord?(m(),k("div",no,"已选择位置：X: "+b(o.mapCoord[0])+", Y: "+b(o.mapCoord[1]),1)):D("",!0)])]),_:1},8,["label"]),s(M,{label:(o.status==="found","详细地点描述"),prop:"location"},{default:a(()=>[s(S,{modelValue:o.location,"onUpdate:modelValue":l[5]||(l[5]=d=>o.location=d),placeholder:"请输入具体地点，如：图书馆三楼、教学楼A座门口、食堂二楼等",type:"textarea",rows:2,maxlength:"100","show-word-limit":""},null,8,["modelValue"]),l[9]||(l[9]=e("div",{class:"location-tip"}," 请详细描述物品的具体位置，方便失主/拾主准确找到地点 ",-1))]),_:1,__:[9]},8,["label"]),s(M,{label:"物品图片",prop:"images"},{default:a(()=>[s(u,{action:"#","list-type":"picture-card","auto-upload":!1,"on-change":U,"file-list":o.images,limit:3,multiple:"",accept:"image/*"},{default:a(()=>[s(r,null,{default:a(()=>[s(z(Be))]),_:1})]),_:1},8,["file-list"])]),_:1}),s(M,{label:"详细描述",prop:"description"},{default:a(()=>[s(S,{modelValue:o.description,"onUpdate:modelValue":l[6]||(l[6]=d=>o.description=d),type:"textarea",rows:3,placeholder:"请详细描述物品的特征，如品牌、颜色、尺寸等"},null,8,["modelValue"])]),_:1}),s(M,{label:"联系方式",prop:"contact"},{default:a(()=>[s(S,{modelValue:o.contact,"onUpdate:modelValue":l[7]||(l[7]=d=>o.contact=d),placeholder:"请输入您的邮箱或电话，方便失主/拾主联系"},null,8,["modelValue"])]),_:1}),s(M,null,{default:a(()=>[s(V,{type:"primary",onClick:_,loading:v.value,style:{width:"100%"}},{default:a(()=>l[10]||(l[10]=[x("确认发布")])),_:1,__:[10]},8,["loading"])]),_:1})]),_:1},8,["model"])}}},ao=oe(lo,[["__scopeId","data-v-e00739d4"]]),ro={__name:"Login",props:{visible:Boolean},emits:["update:visible","switch-register"],setup(p,{emit:E}){const t=E,h=L(),i=L({username:"",password:""}),v={username:[{required:!0,message:"请输入用户名",trigger:"blur"}],password:[{required:!0,message:"请输入密码",trigger:"blur"}]},o=ae();async function y(){h.value.validate(async U=>{if(U)try{const _=await je({username:i.value.username,password:i.value.password});o.setToken(_.data.token),o.setUserInfo(_.data.user),j.success("登录成功"),t("update:visible",!1),i.value.username="",i.value.password=""}catch(_){j.error(_.response?.data?.message||"登录失败")}})}function B(){t("update:visible",!1)}function q(U){t("update:visible",U)}return(U,_)=>{const f=g("el-input"),l=g("el-form-item"),w=g("el-button"),R=g("el-form"),M=g("el-dialog");return m(),A(M,{"model-value":p.visible,"onUpdate:modelValue":q,width:"400px","show-close":!0,center:"",title:"用户登录",onClose:B},{default:a(()=>[s(R,{model:i.value,rules:v,ref_key:"formRef",ref:h,"label-width":"70px",size:"large"},{default:a(()=>[s(l,{label:"用户名",prop:"username"},{default:a(()=>[s(f,{modelValue:i.value.username,"onUpdate:modelValue":_[0]||(_[0]=S=>i.value.username=S),placeholder:"请输入用户名"},null,8,["modelValue"])]),_:1}),s(l,{label:"密码",prop:"password"},{default:a(()=>[s(f,{modelValue:i.value.password,"onUpdate:modelValue":_[1]||(_[1]=S=>i.value.password=S),type:"password",placeholder:"请输入密码","show-password":""},null,8,["modelValue"])]),_:1}),s(l,null,{default:a(()=>[s(w,{type:"primary",onClick:y,style:{width:"100%"}},{default:a(()=>_[3]||(_[3]=[x("登录")])),_:1,__:[3]})]),_:1}),s(l,{style:{"text-align":"center",width:"100%"}},{default:a(()=>[e("span",null,[_[4]||(_[4]=x("还没有账号？")),e("a",{onClick:_[2]||(_[2]=he(S=>U.$emit("switch-register"),["prevent"])),style:{color:"#409eff",cursor:"pointer"}},"立即注册")])]),_:1})]),_:1},8,["model"])]),_:1},8,["model-value"])}}},io={class:"home-layout"},uo={key:0,class:"loading-container"},co={key:1,class:"main-content"},mo={class:"left-panel"},po={class:"filter-section"},vo={key:0,class:"search-status"},fo={class:"search-info"},go={class:"search-text"},ho={class:"search-count"},wo={class:"filter-tabs"},ko=["onClick"],_o={class:"tab-icon"},yo={key:0,width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg"},Co={key:1,width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg"},bo={key:2,width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg"},xo={key:3,width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg"},$o={class:"advanced-filters"},Vo={class:"filter-group"},Io={class:"filter-group"},Lo={key:0,class:"loading-container"},Bo={class:"right-panel"},jo={class:"detail-container"},Mo={key:1,class:"empty-state"},To={style:{"text-align":"center"}},Uo="/map.png",So={__name:"Home",setup(p){const E=ye(),t=L([]),h=L(!1),i=L(new Map),v=L(""),o=L([]),y=L(!1),B=L(!1);let q=null,U=null;async function _(C=!0){if(C&&i.value.has("posts")){const n=i.value.get("posts");if(Date.now()-n.timestamp<3e4){t.value=n.data,t.value?.length>0&&!c.value&&(c.value=t.value[0].id);return}}h.value=!0;try{const n=await Se();t.value=n.data,i.value.set("posts",{data:n.data,timestamp:Date.now()}),t.value&&t.value.length>0&&!c.value&&(c.value=t.value[0].id)}catch(n){console.error("获取帖子失败:",n),t.value=[]}finally{h.value=!1}}function f(){q&&clearTimeout(q),q=setTimeout(()=>_(!1),300)}async function l(C){U&&clearTimeout(U),U=setTimeout(async()=>{try{if(v.value=C,!C||!C.trim()){y.value=!1,o.value=[],c.value=t.value?.length>0?t.value[0].id:null;return}y.value=!0,B.value=!0;const n=await De(C.trim());o.value=n.data.results||[],o.value.length>0?c.value=o.value[0].id:c.value=null}catch(n){console.error("搜索失败:",n),o.value=[],c.value=null}finally{B.value=!1}},300)}function w(C){l(C)}function R(){v.value="",y.value=!1,o.value=[],c.value=t.value?.length>0?t.value[0].id:null}ve(async()=>{if(ee.token&&!ee.userInfo)try{await ee.refreshUserInfo()}catch(C){console.error("初始化用户状态失败:",C)}_(),window.addEventListener("show-login-tip",ie),window.addEventListener("show-publish-dialog",()=>{K.value=!0}),window.addEventListener("focus",f),window.addEventListener("post-published",()=>{_(!1)}),window.addEventListener("claim-status-updated",H)}),fe(()=>{window.removeEventListener("show-login-tip",ie),window.removeEventListener("show-publish-dialog",()=>{K.value=!0}),window.removeEventListener("focus",f),window.removeEventListener("post-published",()=>{_(!1)}),window.removeEventListener("claim-status-updated",H),q&&clearTimeout(q)}),te(()=>E.query.selected,C=>{C&&t.value.length>0&&(c.value=C)},{immediate:!0}),te(t,C=>{C.length>0&&E.query.selected&&C.find(I=>I.id===E.query.selected)&&(c.value=E.query.selected)},{immediate:!0});function M(){K.value=!1,_(!1)}async function S(C){if(!(!c.value||!C.trim()))try{await Ee(c.value,C.trim()),await _(!1),c.value=c.value}catch(n){console.error("添加评论失败:",n)}}async function H(){try{i.value.clear(),await _(!1),y.value&&v.value&&await l(v.value)}catch(C){console.error("刷新数据失败:",C)}}const r=L("all"),u=L(null),V=L("all"),c=L(null),d=[{label:"全部",value:"all"},{label:"失物",value:"lost"},{label:"招领",value:"found"},{label:"已认领",value:"claimed"}],Z=Y(()=>{if(!c.value)return null;const C=y.value?o.value:t.value;return C?C.find(n=>n.id===c.value):null}),T=Y(()=>{const C=y.value?o.value:t.value;return!C||C.length===0?[]:C.filter(I=>{const P=r.value==="all"?!0:r.value==="claimed"?I.claimed||I.is_claimed:r.value==="found"?I.status==="found"&&!(I.claimed||I.is_claimed):I.status===r.value&&!(I.claimed||I.is_claimed),ne=V.value==="all"||I.category===V.value,F=(()=>{if(!u.value)return!0;if(!I.date&&!I.created_at)return!1;try{const W=I.created_at||I.date,X=new Date(W),$=new Date(u.value);return X>=$}catch{return!1}})();return P&&ne&&F}).sort((I,P)=>{if(r.value==="all"){const W=I.claimed||I.is_claimed,X=P.claimed||P.is_claimed;if(W&&!X)return 1;if(!W&&X)return-1;if(W&&X){const $=new Date(I.claimedAt||I.claimed_at||I.created_at||I.date);return new Date(P.claimedAt||P.claimed_at||P.created_at||P.date)-$}}const ne=new Date(I.date||I.created_at);return new Date(P.date||P.created_at)-ne})});function O(C){c.value=C}function J(){N.value=!1,se.value=!0}function ce(){se.value=!1,N.value=!0}const ee=ae(),K=L(!1),N=L(!1),se=L(!1),re=L(!1),ke=Y(()=>ee.isLogin);function ie(){re.value=!0}ve(()=>{window.addEventListener("show-login-tip",ie)}),fe(()=>{window.removeEventListener("show-login-tip",ie)});function be(){re.value=!1,N.value=!0}return(C,n)=>{const I=g("el-loading"),P=g("el-button"),ne=g("el-date-picker"),F=g("el-option"),W=g("el-select"),X=g("el-dialog");return m(),k("div",io,[s(Qe,{onPublish:n[0]||(n[0]=$=>K.value=!0),onLogin:n[1]||(n[1]=$=>N.value=!0),onRegister:n[2]||(n[2]=$=>se.value=!0),onSearch:w}),h.value?(m(),k("div",uo,[s(I,{loading:h.value,text:"加载中..."},{default:a(()=>n[11]||(n[11]=[e("div",{style:{height:"400px"}},null,-1)])),_:1,__:[11]},8,["loading"])])):(m(),k("div",co,[e("div",mo,[e("div",po,[y.value?(m(),k("div",vo,[e("div",fo,[n[12]||(n[12]=e("span",{class:"search-icon"},[e("svg",{width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg"},[e("circle",{cx:"11",cy:"11",r:"8",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"}),e("path",{d:"M21 21L16.514 16.506L21 21Z",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"})])],-1)),e("span",go,'搜索："'+b(v.value)+'"',1),e("span",ho,"("+b(o.value.length)+"条结果)",1)]),s(P,{type:"text",size:"small",class:"clear-search-btn",onClick:R},{default:a(()=>n[13]||(n[13]=[x(" 清除搜索 ")])),_:1,__:[13]})])):D("",!0),e("div",wo,[(m(),k(ue,null,de(d,$=>e("button",{key:$.value,class:G(["filter-tab",{active:r.value===$.value}]),onClick:xe=>r.value=$.value},[e("span",_o,[$.value==="all"?(m(),k("svg",yo,n[14]||(n[14]=[e("path",{d:"M3 3H21V21H3V3Z",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},null,-1),e("path",{d:"M3 9H21",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},null,-1),e("path",{d:"M9 21V9",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},null,-1)]))):$.value==="lost"?(m(),k("svg",Co,n[15]||(n[15]=[e("circle",{cx:"11",cy:"11",r:"8",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},null,-1),e("path",{d:"M21 21L16.514 16.506L21 21Z",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},null,-1)]))):$.value==="found"?(m(),k("svg",bo,n[16]||(n[16]=[e("path",{d:"M22 11.08V12C21.9988 14.1564 21.3005 16.2547 20.0093 17.9818C18.7182 19.7088 16.9033 20.9725 14.8354 21.5839C12.7674 22.1953 10.5573 22.1219 8.53447 21.3746C6.51168 20.6273 4.78465 19.2461 3.61096 17.4371C2.43727 15.628 1.87979 13.4881 2.02168 11.3363C2.16356 9.18455 2.99721 7.13631 4.39828 5.49706C5.79935 3.85781 7.69279 2.71537 9.79619 2.24013C11.8996 1.76488 14.1003 1.98232 16.07 2.85999",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},null,-1),e("polyline",{points:"22,4 12,14.01 9,11.01",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},null,-1)]))):(m(),k("svg",xo,n[17]||(n[17]=[e("path",{d:"M20 6L9 17L4 12",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},null,-1)])))]),x(" "+b($.label),1)],10,ko)),64))]),e("div",$o,[e("div",Vo,[n[18]||(n[18]=e("label",{class:"filter-label"},"时间筛选",-1)),s(ne,{modelValue:u.value,"onUpdate:modelValue":n[3]||(n[3]=$=>u.value=$),type:"date",placeholder:"显示此日期后的帖子",class:"date-picker",size:"small",clearable:""},null,8,["modelValue"])]),e("div",Io,[n[19]||(n[19]=e("label",{class:"filter-label"},"类别筛选",-1)),s(W,{modelValue:V.value,"onUpdate:modelValue":n[4]||(n[4]=$=>V.value=$),placeholder:"选择类别",size:"small",class:"category-picker",clearable:""},{default:a(()=>[s(F,{label:"全部类别",value:"all"}),s(F,{label:"证件卡类",value:"id"}),s(F,{label:"电子设备",value:"electronics"}),s(F,{label:"书籍文具",value:"book"}),s(F,{label:"衣物包类",value:"clothes"}),s(F,{label:"钥匙卡类",value:"key"}),s(F,{label:"其他物品",value:"other"})]),_:1},8,["modelValue"])])])]),h.value||B.value?(m(),k("div",Lo,[s(I,{loading:!0,text:"加载中..."},{default:a(()=>n[20]||(n[20]=[e("div",{style:{height:"200px"}},null,-1)])),_:1,__:[20]})])):(m(),A(dt,{key:1,posts:T.value,selectedId:c.value,"is-login":ke.value,onSelect:O,onRequireLogin:n[5]||(n[5]=$=>N.value=!0)},null,8,["posts","selectedId","is-login"]))]),e("div",Bo,[e("div",jo,[Z.value?(m(),A(to,{key:0,post:Z.value,"map-img":Uo,"is-login":ke.value,onRequireLogin:n[6]||(n[6]=$=>N.value=!0),onComment:S},null,8,["post","is-login"])):(m(),k("div",Mo,n[21]||(n[21]=[e("div",{class:"empty-icon"},[e("svg",{width:"64",height:"64",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg"},[e("circle",{cx:"11",cy:"11",r:"8",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"}),e("path",{d:"M21 21L16.514 16.506L21 21Z",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"})])],-1),e("h3",null,"请选择一条帖子",-1),e("p",null,"从左侧列表中选择一条帖子查看详细信息",-1)])))])])])),s(X,{modelValue:K.value,"onUpdate:modelValue":n[7]||(n[7]=$=>K.value=$),title:"发布新信息",width:"650px","close-on-click-modal":!1,class:"post-dialog"},{default:a(()=>[s(ao,{onSuccess:M})]),_:1},8,["modelValue"]),s(ro,{visible:N.value,"onUpdate:visible":n[8]||(n[8]=$=>N.value=$),onSwitchRegister:J},null,8,["visible"]),s(qe,{visible:se.value,"onUpdate:visible":n[9]||(n[9]=$=>se.value=$),onSwitchLogin:ce},null,8,["visible"]),s(X,{modelValue:re.value,"onUpdate:modelValue":n[10]||(n[10]=$=>re.value=$),title:"未登录",width:"340px","show-close":!0,center:""},{default:a(()=>[e("div",To,[n[23]||(n[23]=e("div",{style:{"font-size":"18px",color:"#ff9800","margin-bottom":"12px"}},"请先登录后再访问个人中心",-1)),s(P,{type:"primary",onClick:be},{default:a(()=>n[22]||(n[22]=[x("去登录")])),_:1,__:[22]})])]),_:1},8,["modelValue"])])}}},Po=oe(So,[["__scopeId","data-v-24788d23"]]);export{Po as default};
